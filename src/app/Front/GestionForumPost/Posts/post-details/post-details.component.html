<app-header-front></app-header-front>

<!-- Header Start -->
<div class="container-fluid page-header" style="margin-bottom: 90px;">
    <div class="container">
        <div class="d-flex flex-column justify-content-center" style="min-height: 300px">
            <h3 class="display-4 text-white text-uppercase">Post</h3>
            <div class="d-inline-flex text-white">
                <p class="m-0 text-uppercase"><a class="text-white" href="">Home</a></p>
                <i class="fa fa-angle-double-right pt-1 px-3"></i>
                <p class="m-0 text-uppercase">Post details</p>
            </div>
        </div>
    </div>
</div>
<!-- Header End -->

<!-- Detail Start -->
<div class="container-fluid py-5">
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8">
                <div class="mb-5">
                    <!-- Affichage de la date du post -->
                    <h6 class="text-primary mb-3">{{ post?.createdAt | date: 'MMM dd, yyyy' }}</h6>
                    <!-- Affichage du titre du post -->
                    <h1 class="mb-5">{{ post?.title }}</h1>
                    <!-- Affichage de l'image du post -->
                    <img *ngIf="post?.ImageP" [src]="'data:image/jpeg;base64,' + post?.ImageP" class="img-fluid rounded w-100 mb-4" alt="Post image">
                    <!-- Affichage du contenu du post -->
                    <p>{{ post?.content }}</p>
                </div>
<!-- Emoji Reactions Section -->
<div class="mb-4">
    <h5 class="mb-2">Réagis à ce post :</h5>
    <div class="d-flex gap-2 flex-wrap">
      <button *ngFor="let emoji of emojis"
        (click)="reactToPost(emoji)"
        class="btn d-flex align-items-center gap-2 p-2 rounded-pill shadow-sm"
        [ngStyle]="{ 
          'background-color': getEmojiColor(emoji),
          'color': 'white'
        }">
        
        <!-- Emoji unicode -->
        <span class="fs-5">{{ emoji }}</span>
  
        <!-- Compteur de réactions -->
        <span class="badge bg-light text-dark">
          {{ emojiCounts[EmojiTypeMapping[emoji]] || 0 }}
        </span>
      </button>
    </div>
  </div>
  
  
  
                <!-- Post Comments Section -->
                <div class="mb-5">
                    <h2 class="text-uppercase mb-4 fw-bold" style="letter-spacing: 3px;">Comments</h2>

                    <!-- Display Post Comments -->
                    <div *ngFor="let comment of comments" class="comment-card mb-4 p-3 bg-light rounded">
                        <div class="d-flex align-items-start">
                            <!-- User Avatar -->
                            <div class="me-3">
                                <img [src]="usersMap[comment.email]?.image || 'assets/assetsFront/img/user.jpg'"
                                     class="rounded-circle" width="60" height="60" alt="User avatar">
                            </div>

                            <!-- Comment Content -->
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="mb-0 fw-bold">{{ usersMap[comment.email]?.name || 'Anonymous' }}</h5>
                                    <small class="text-muted">
                                        <i>Posted At: {{ comment.created_at | date: 'dd/MM/yyyy à HH:mm'}}</i>
                                        <i>Posted By: {{ comment.email }}</i>
                                    </small>
                                </div>

                                <p class="mb-2">{{ comment.content }}</p>

                                <!-- Delete Button if the comment was posted by the current user -->
                                <button *ngIf="currentUser?.email === comment.email"
                                        class="btn btn-sm btn-danger"
                                        (click)="deleteComment(comment.idComment)">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- If no comments -->
                    <div *ngIf="comments.length === 0" class="alert alert-info mt-3">
                        No comments for this post yet.
                    </div>

                    <!-- Button to open the modal for adding a new comment -->
                    <button type="button" class="btn btn-primary" (click)="showCommentModalOpen = true">
                        Leave a Comment
                    </button>
                </div>
            </div>
            <!-- Comment List End -->

            <div class="col-lg-4 mt-5 mt-lg-0">
                <!-- Author Bio -->
                <div class="d-flex flex-column text-center bg-dark rounded mb-5 py-5 px-4">
                    <img [src]="'data:image/jpeg;base64,' + post?.user?.image" 
                    class="img-fluid rounded-circle mx-auto mb-3" 
                    style="width: 100px;" 
                    alt="User Image">
                                   <h3 class="text-primary mb-3">{{ post?.user?.name }}</h3>
                    <h3 class="text-uppercase mb-4" style="letter-spacing: 5px;">Tag Cloud</h3>
                    <p class="text-white m-0">{{ post?.user?.bio }}</p>
                </div>

                <!-- Sidebar Start -->
                <div class="col-lg-4 mt-5 mt-lg-0">

                    <!-- Search Form -->
                    <div class="mb-5">
                        <form action="">
                            <div class="input-group">
                                <input type="text" class="form-control form-control-lg" placeholder="Keyword">
                                <div class="input-group-append">
                                    <span class="input-group-text bg-transparent text-primary"><i class="fa fa-search"></i></span>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Category List -->
                    <div class="mb-5">
                        <h3 class="text-uppercase mb-4" style="letter-spacing: 5px;">Categories</h3>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <a href="" class="text-decoration-none h6 m-0">Web Design</a>
                                <span class="badge badge-primary badge-pill">150</span>
                            </li>
                            <!-- More categories can be added here -->
                        </ul>
                    </div>

                    <!-- Recent Post -->
                    <div class="mb-5">
                        <h3 class="text-uppercase mb-4" style="letter-spacing: 5px;">Recent Post</h3>
                        <a class="d-flex align-items-center text-decoration-none mb-3" href="">
                            <img class="img-fluid rounded" src="assets/assetsFront/img/blog-80x80.jpg" alt="">
                            <div class="pl-3">
                                <h6 class="m-1">Diam lorem dolore justo eirmod lorem dolore</h6>
                                <small>Jan 01, 2050</small>
                            </div>
                        </a>
                    </div>

                    <!-- Tag Cloud -->
                    <div class="mb-5">
                        <h3 class="text-uppercase mb-4" style="letter-spacing: 5px;">Tag Cloud</h3>
                        <div class="d-flex flex-wrap m-n1">
                            <a href="" class="btn btn-outline-primary m-1">Design</a>
                            <a href="" class="btn btn-outline-primary m-1">Development</a>
                            <a href="" class="btn btn-outline-primary m-1">Marketing</a>
                        </div>
                    </div>
                </div>
                <!-- Sidebar End -->
            </div>
        </div>
    </div>
</div>
<!-- Detail End -->

<!-- Modal Ajouter Commentaire -->
<div *ngIf="showCommentModalOpen" class="modal fade show d-block" tabindex="-1" role="dialog"
     style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Leave a Comment</h5>
                <button type="button" class="btn-close" (click)="showCommentModalOpen = false"></button>
            </div>
            <div class="modal-body">
                <textarea [(ngModel)]="newComment.content" class="form-control" placeholder="Write your comment here..." rows="4"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="showCommentModalOpen = false">Close</button>
                <button class="btn btn-primary" (click)="addComment()">Submit Comment</button>
            </div>
        </div>
    </div>
</div>



<app-footer-front></app-footer-front>
